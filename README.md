# Разработка интернет-приложения организации спортивного досуга
## Идея
Проект служит формирования команд для совместного проведения спортивного досуга. Клиенты интернет-приложения могут спланировать свой досуг: игра в футбол, баскетбол, групповые спортивные занятия и т.д. После регистрации пользователю доступны все имеющиеся на данный момент события с именами участников, места проведения и времени. Благодаря чему он может присоединиться к данной активности.
Разработанное приложение поможет людям заводить новые знакомства, активно проводить время и поддерживать свою физическую форму. Также приложение разработано для Android-смартфонов, что позволяет следить за датой и временем встречи из любого места с телефона, записываться на события в любое удобное время. Благодаря разработанному интернет-приложению проведение совместного досуга будет еще более увлекательным и интересным. Пользователи также могут приглашать на события своих друзей и знакомых.
## Техническая реализация
Проект имеет две составляющие: frontend и backend. Frontend в свою очередь имеет реализацию для пользователей ПК (веб-версия) и для владельцев смартфонов с ОС Android.
Backend написан на языке программирования golang. В качестве базы данных используется PostgreSQL. Взаимодействие с backend происходит через REST API запросы: GET, POST, PATCH, DELETE.
GET запросы используются для получения CSRF токена, события и приглашений. POST запросы принимаются backend’ом, после чего представленная информация либо записывается в БД, либо обрабатывается сервером, после чего приходит подтверждение успешно проведенной обработки или записи, либо ошибка. PATCH используется для редактирования, обновления события после добавления или удаления участников, изменения информации о встрече.

На реализованном веб-сервере доступно https подключение с помощью использования библиотеки OpenSSL и получения самоподписанного сертификата.

В качестве веб-фреймворка был выбран Gin. Gin это высокопроизводительный микрофреймворк, который используется для создания веб-приложений и микросервисов. С ним очень удобно делать комплексную конвейерную обработку запросов из модулей — многократно используемых кусочков кода. Вы пишете промежуточный слой приложения, который затем подключается в один или более обработчик запросов или в группу обработчиков. Он содержит набор часто употребляемых функций, таких как роутинг, поддержка middleware, обработка шаблонов. Вдобавок к этому, он позволяет уменьшить количество кода в приложениях и создание веб-приложений с ним намного проще.

В папке cmd содержится файл main.go, запускающий прослушивание порта и ip адреса. Эти данные берутся из файла configs.yml, находящегося в папке config.

Для использования https в конфигурационном файле указан белый ip адрес сервера VPS, прослушиваемый порт, сгенерированные самоподписанные сертификаты, хранящиеся в скрытой директории .certificate. Для базы данных аналогичные параметры с добавлением username для работы внутри БД. Также указан шаблон для отправки сообщения второго фактора на почту. В файле docs лежат файлы для описания API веб-сервера с помощью Swagger.

Логика обработки REST API запросов находится в директории backend\internal\service. Там для каждого этапа работы пользователя сформирован файл с расширением .go, обрабатывающий запросы регистрации, входа, работы с событиями.
База данных PostgreSQL реализована в виде docker контейнера.
```bash
docker pull postgres
docker run --name=BIP -e POSTGRES_PASSWORD='*****' -p 5436:5432 -d --rm postgres
```
После успешного запуска контейнера импортировались таблицы с помощью утилиты migrate командой: 
```bash
migrate -path ./schema -database 'postgres://postgres:qwerty@localhost:5436/postgres?sslmode=disable' up
```
В директории schema содержаться SQL-запросы на создание таблиц. Переменные окружения хранятся в скрытом файле .env.

Для авторизации пользователей используются JWT токены. По сути это JSON объект, который определен в открытом стандарте RFC 7519. Он считается одним из безопасных способов передачи информации между двумя участниками. Для его создания необходимо определить заголовок (header) с общей информацией по токену, полезные данные (payload), такие как id пользователя, его роль и т.д. и подписи (signature). В полезных данных используемые токены содержат ID и время. Время используется для отзыва токена.

Так же для защиты от CSRF атак используются CSRF токены. Из трех возможных вариантов применяется Double Submit Cookie. То есть при запросе пользователя ему сервером отправляются cookie и токен. При последующих запросах cookie и токен добавляются в заголовок запроса.

Реализована защита от перебора пароля. Сохраняются данные входа и их количество, при увеличении количества попыток время ожидания экспоненциально растет. 

Frontend для веб-версии реализован с помощью языка программирования Java Script и языка разметки HTML. Для отправки запросов использовалась синхронная версия XMLHTTPRequest(). CSS применяется для описания внешнего вида сайта. Необходимая пользователю для отправки запросов информация: CSRF-токен, JWT-токен, user_id,– хранятся в localstorage. Запись происходит через .setItem(), а получение через .getItem().

Для размещения frontend по адресу арендованного сервера был использован nginx, для которого было настроено перенаправление трафика http на https для предотвращения использования незащищенной версии сайта и атак ssl-strip.

Android приложение было написано на языке java. Для отправки запросов приложения сначала необходимо разрешить использование самоподписанных сертификатов. Для отправки и получения запросов использовалась библиотека okhttp3. Для начала необходимо отправить GET запрос для получения CSRF токена. Также в ответе в заголовке “Set-Cookie” приходят куки. После аутентификации сервер отправляет JWT токен. 
